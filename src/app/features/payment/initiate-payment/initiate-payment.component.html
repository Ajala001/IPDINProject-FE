<div class="page-wrap">
  <div class="card">
    <!-- Personalized User Info -->
    <div class="user-header" *ngIf="user">
      <h2 class="user-greeting">ðŸ‘‹ Hello, {{ user.fullName || user.name }}</h2>
      <p class="user-email">{{ user.email }}</p>
    </div>

    <h2 class="title">Make a Payment</h2>

    <form [formGroup]="paymentForm" (ngSubmit)="onSubmit()" novalidate>
      <!-- Payment Type -->
      <label class="label" for="paymentType">Payment Category</label>
      <select
        id="paymentType"
        class="select"
        formControlName="paymentType"
        [disabled]="isLoading"
      >
        <option value="">-- choose category --</option>
        <option *ngFor="let type of paymentCategories" [value]="type">
          {{ type }}
        </option>
      </select>

      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading">
        <p>Loading available services, please wait...</p>
      </div>

      <!-- Service Selection -->
      <div class="services" *ngIf="showServices && availableServices.length > 0">
        <label class="label">Select Service</label>
        <div class="service-list">
          <label
            class="service-item"
            *ngFor="let s of availableServices"
            [for]="s.id"
          >
            <input type="radio" [id]="s.id" formControlName="service" [value]="s.id" />
            <div class="service-meta">
              <div class="service-title">{{ s.name }}</div>
              <div class="service-desc">Fee: â‚¦{{ s.amount | number }}</div>
            </div>
            <div class="service-price">â‚¦{{ s.amount | number }}</div>
          </label>
        </div>
      </div>

      <!-- Empty State -->
      <div
        class="no-services"
        *ngIf="!isLoading && showServices && availableServices.length === 0"
      >
        <p>
          There are no active
          <strong>{{ paymentForm.value.paymentType }}</strong> services
          available right now.
        </p>
        <p class="muted">
          Please check back later or contact support for assistance.
        </p>
      </div>

      <!-- Flat Amount Display -->
      <div class="flat-amount" *ngIf="showAmount && !showServices">
        <label class="label">Amount to Pay</label>
        <div class="amount-box">â‚¦{{ amount | number }}</div>
      </div>

      <!-- Summary -->
      <div class="summary" *ngIf="paymentForm.valid">
        <div class="summary-row">
          <span>Category:</span>
          <span>{{ paymentForm.value.paymentType }}</span>
        </div>

        <div class="summary-row" *ngIf="showServices && paymentForm.value.service">
          <span>Selected Service:</span>
          <span>{{ getSelectedServiceName() }}</span>
        </div>

        <div class="summary-row">
          <span>Total Amount:</span>
          <span>â‚¦{{ showAmount ? amount : getSelectedServiceAmount() | number }}</span>
        </div>
      </div>

      <!-- Actions -->
      <div class="actions">
        <button
          type="button"
          class="btn btn-secondary"
          (click)="router.navigateByUrl('dashboard')"
        >
          Cancel
        </button>

        <button
          type="submit"
          class="btn btn-primary"
          [disabled]="paymentForm.invalid || isLoading"
        >
          {{ isLoading ? 'Processing...' : 'Proceed to Pay' }}
        </button>
      </div>

      <p class="note">
        Please ensure all selections are correct before proceeding to payment.
      </p>
    </form>
  </div>
</div>
